---
title: "Análisis AIRBNB"
author: "Grupo 12"
date: "2024-10-06"
output: 
  html_document:
    toc: true
    toc_depth: 5
    toc_float: 
     collapsed: true
     smooth_scroll: true
---

```{r setup, include=FALSE, purl=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      eval = TRUE, 
                      warning = FALSE,
                      message = FALSE,
                      error = TRUE)
```

## Introducción y definición de objetivos

Durante estos últimos años, plataformas donde se reservan propiedades durante un tiempo determinado, como es Airbnb, han ido subiendo su popularidad y mucha gente opta por este tipo de servicio. Es por ello que un análisis de este modelo de negocio es interesante tanto para los clientes como para la empresa propietaria de Airbnb. Por ello, el objetivo de esta investigación es observar como afectan al precio las distintas variables.

Hemos descartado algunas variables dentro de esta base de datos. La primera es la variable bed_type, la cual descartamos ya que, tras hacer análisis previos, realmente no llevaría a cabo ningún cambio debido a que la gran mayoria son del mismo tipo (real bed). Las siguientes variables que hemos descartado son la de "latitud", "longitud" y "zipcode", ya que tienen que ver con la localización de la propiedad y eso ya se refleja con las variables "city" y "neighbourhood". Otra variable descartada es "amenities" ya que aparecían muchas más variables internas a esta que complicarían el análisis. Con la variable "accomodates", referida al número de personas que se alojan en la propiedad, decidimos descartarla porque hay otras variables como el número de camas que la hacen redundante. La variable "host_response_rate" (la tasa de respuesta del anfitrión) la descartamos ya que en muchos de los casos no hay información. Las variables como "first review" (fecha en que se realizó la primera valoración), "last review" (fecha en que se realizó la última valoración), "description" (la descripción), "host_has_profile_pic" (si el anfitrión tiene foto de perfil en Airbnb), "host_since" (fecha en la que se publicó por primera vez la propiedad), "name" (nombre de la propiedad) o "thumbnail_url" (URL de la página de la habitación)han sido descartadas porque no son relevantes para nuestro análisis.

## Importación de datos y paquetes usados

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(readr)
library(tidyverse)
library(ggplot2)
library(summarytools)
library(GGally)
library(knitr)
library(ggcorrplot)
library(corrplot)
library(htmltools)

Airbnb_Data <- read_csv("Airbnb_Data.csv")
```

## Diccionario de datos

-   `price` : Precio de la reserva de AIRBNB en dólares.

    -   Tipo: Numérica continua.

-   `property_type`: Tipo de propiedad que se reserva.

    -   Tipo: Categórica multinivel.

-   `room_type`: Tipo de habitación que incluye la reserva.

    -   Tipo: Categórica multinivel.

-   `bathrooms`: Número de baños que contiene la propiedad.

    -   Tipo: Numérica continua.

-   `bedrooms`: Número de habitaciones de la propiedad.

    -   Tipo: Numérica discreta.

-   `beds`: Número de camas de la propiedad.

    -   Tipo: Numérica discreta.

-   `bed_type`: Tipo de cama que ofrece la propiedad.

    -   Tipo: Categórica multinivel.

-   `cancellation_policy`: Tipo de política de cancelación.

    -   Tipo: Categórica ordinal.

-   `cleaning_fee`: Tarifa por limpieza.

    -   Tipo: Categórica dicotómica. (TRUE, hay / FALSE, no hay)

-   `city`: Ciudad donde se ubica la propiedad.

    -   Tipo: Categórica multinivel.

-   `neighbourhood`: Barrio donde se ubica la propiedad.

    -   Tipo: Categórica multinivel.

-   `host_identity_verified`: Anfitrión verificado en Airbnb.

    -   Tipo: Categórica dicotómica. (TRUE, sí / FALSE, no)

-   `instant_bookable`: Reservar la propiedad al instante.

    -   Tipo: Categórica dicotómica. (TRUE, sí / FALSE, no)

-   `number_of_reviews`: Número de valoraciones de la propiedad.

    -   Tipo: Numérica discreta.

-   `review_scores_rating`: Puntuación de las valoraciones de la propiedad.

    -   Tipo: Numérica discreta.

## Análisis exploratorio de datos

Comenzamos realizando un estudio de todas las variables de manera univariante.

### Análisis univariante:

#### Estudio de la variable price

Antes de estudiar la variable price, observamos que esta se encuentra de forma logarítmica, por tanto, para verlo todo de manera más clara, simplemente invertimos el logaritmo para obtener precios con más sentido.

```{r CambioPrice}
Airbnb_Data$log_price = exp(Airbnb_Data$log_price)
```

A pesar de haber invertido el logaritmo, en la parte de código seguiremos referenciando esta variable como log_price, sin embargo, en las gráficas aparecerá como price en todo momento. Ahora sí comenzamos con el análisis de price.

CONTAR EL NÚMERO DE RESPUESTAS

```{r NumRespuestasPrice, echo=TRUE}
num_respuestas_PRICE <- length(unique(Airbnb_Data$log_price))
cat("La cantidad de respuestas obtenidas es:", num_respuestas_PRICE)
```

Dada la alta cantidad de respuestas distintas, para poder visualizar todo en una tabla de frecuencias de manera medianamente clara, procedemos a dividir los precios en intervalos de 25.

TABLA DE FRECUENCIAS

Estudiamos las frecuencias relativas y absolutas.

```{r}
intervalos <- seq(0, ceiling(max(Airbnb_Data$log_price)/25) * 25, by = 25)
tabla_frecuencias_price <- Airbnb_Data |> count(log_price) |> mutate(f = n / nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
 tabla_frecuencias_price <- tabla_frecuencias_price |> mutate(Intervalo = cut(log_price, breaks = intervalos, right = FALSE)) |> group_by(Intervalo) |> summarise (n = sum(n), f = sum(f), N = sum(n), F = sum(f))
 for (i in 2: nrow(tabla_frecuencias_price)) {
   tabla_frecuencias_price$N[i] <- tabla_frecuencias_price$N[i] + tabla_frecuencias_price$N[i-1]
    tabla_frecuencias_price$F[i] <- tabla_frecuencias_price$F[i] + tabla_frecuencias_price$F[i-1]}
 tabla_frecuencias_ordenada1 <- tabla_frecuencias_price |> arrange(Intervalo)
 print(tabla_frecuencias_ordenada1)
```

HISTOGRAMA DE PRECIOS

Ahora realizamos el histograma para verlo mucho más claro.

```{r}
datos <- Airbnb_Data$log_price  
 ggplot(data.frame(x = datos), aes(x = x)) +
     geom_histogram(binwidth = 25, fill = "#F16E79", color = "black", 
                    ) +
  
     labs(title = "Distribución de los precios",
          x = "Precios",
          y = "Frecuencia") 
```

Como podemos observar, la mayor parte de los precios se encuentra por debajo de los 300\$, donde se ve una clara curva descendente según el precio va aumentando, llegando hasta un máximo de unos 2000\$.

RESUMEN NUMÉRICO DE LOS PRECIOS

Es necesario realizar también un resumen numérico para poder interpretar mejor el histograma.

```{r ResumenPrice}
Airbnb_Data |> select(log_price) |> descr() |> kable(digits = 2)
```

Igual que hemos visto en el histograma, el resumen numérico nos demuestra que la mayor parte de los precios se concentran entre 1\$ y los 185\$, con una media de 160.37\$ y una mediana de 111\$. El precio mínimo es de 1\$ y el máximo es de 1999\$, aunque en muy pocos casos se dan estos valores.

#### Estudio de la variable property_type

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_TYPE <- length(unique(Airbnb_Data$property_type))
cat("La cantidad de respuestas obtenidas es:", num_respuestas_TYPE)
```

Como podemos observar, aquí sí tiene sentido realizar un estudio para poder ver el tipo de casa que más se oferta.

TABLA DE FRECUENCIAS

Ahora estudiaremos las frecuencias relativas y absolutas.

```{r}
tabla_frecuencias_type <- Airbnb_Data |>
     count(property_type) |>
    mutate(f = n / nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))

tabla_frecuencias_ordenada2 <- tabla_frecuencias_type |>
    arrange(desc(n))

tabla_frecuencias_ordenada2$F <- cumsum(tabla_frecuencias_ordenada2$f)

tabla_frecuencias_ordenada2$N <- cumsum(tabla_frecuencias_ordenada2$n)

print(tabla_frecuencias_ordenada2)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA DE PROPERTY_TYPE

Para poder observar con mayor claridad los datos en función de la frecuencia relativa realizaremos una gráfica.

```{r}
Airbnb_Data |> group_by(property_type) |> summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), property_type = reorder(property_type, -Frequency)) |> ggplot(aes(x = property_type, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de property_type", x = "Tipo de casa", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

De la misma forma realizaremos una gráfica con los datos en función de la frecuencia absoluta.

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA DE PROPERTY_TYPE

```{r}
Airbnb_Data |>
     group_by(property_type) |>
     summarise(Frequency = n()) |>
     mutate(property_type = reorder(property_type, -Frequency)) |>
    ggplot(aes(x = property_type, y = Frequency)) +
     geom_bar(stat = "identity", aes(fill = Frequency)) +
     theme_bw() +
     labs(title = "Gráfico de barras con frecuencia absoluta de property_type",
          x = "Tipo de casa",
          y = "Frecuencia absoluta") +
     scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Aunque hay gran variedad de tipos de propiedades, se observa claramente que la mayor parte de las ofertas son de apartamentos, con un 66,1% del total, seguido de las casas particulares con un 22,3% y ya con mucha diferencia están los condominios con un 3,59%. El resto de tipos de propiedades suman entre sí un 5,7%.

#### Estudio de la variable room_type

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_TYPE <- length(unique(Airbnb_Data$room_type))
cat("La cantidad de respuestas obtenidas es:", num_respuestas_TYPE)
```

Vamos a realizar el estudio para ver cuales son los tipos de habitaciones que más se ofertan en la plataforma.

TABLA DE FRECUENCIAS

Primero estudiaremos las frecuencias relativas y absolutas

```{r}
tabla_frecuencias_type <- Airbnb_Data |>
     count(room_type) |>
    mutate(f = n / nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
 tabla_frecuencias_ordenada3 <- tabla_frecuencias_type |>
    arrange(desc(n))
 tabla_frecuencias_ordenada3$F <- cumsum(tabla_frecuencias_ordenada3$f)
 tabla_frecuencias_ordenada3$N <- cumsum(tabla_frecuencias_ordenada3$n)
 print(tabla_frecuencias_ordenada3)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA DE ROOM_TYPE

Para poder observar con mayor claridad los datos en función de la frecuencia relativa realizaremos una gráfica.

```{r}
Airbnb_Data  |> group_by(room_type) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), room_type = reorder(room_type, -Frequency)) |> ggplot(aes(x = room_type, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de room_type", x = "Tipo de habitación", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA DE ROOM_TYPE

De la misma forma realizaremos una gráfica con los datos en función de la frecuencia absoluta.

```{r}
Airbnb_Data  |> group_by(room_type) |>  summarise(Frequency = n()) |> mutate(room_type = reorder(room_type, -Frequency)) |> ggplot(aes(x = room_type, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de room_type", x = "Tipo de habitación", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Estas gáficas nos muestran que la mayoría de ofertas nos ofrecen la totalidad de la propiedad que alquilamos, con más del 50%, seguidas por las ofertas que de una habitación privada, con un poco más del 40% del total, mientras que las habitaciones compartidas son una minoría con un 5% del total de ofertas.

#### Estudio de la variable bathrooms

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_Bathrooms <- length(unique(Airbnb_Data$bathrooms))
cat("La cantidad de respuestas obtenidas es:", num_respuestas_Bathrooms)

```

Aquí vamos a realizar un estudio para poder ver el número de baños que más se ofertan en la plataforma.

TABLA DE FRECUENCIAS

Estudiamos las frecuencias relativas y absolutas.

```{r}
tabla_frecuencias_bathrooms <- Airbnb_Data |> count(bathrooms) |> mutate(f = n / nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f)) 
tabla_frecuencias_ordenada4 <- tabla_frecuencias_bathrooms |>
    arrange(desc(n))
 tabla_frecuencias_ordenada4$F <- cumsum(tabla_frecuencias_ordenada4$f)
 tabla_frecuencias_ordenada4$N <- cumsum(tabla_frecuencias_ordenada4$n)
 print(tabla_frecuencias_ordenada4)
```

HISTOGRAMA DEL NÚMERO DE BAÑOS

Vamos a realizar un histograma con el número de baños que se ofertan.

```{r}
datos <- Airbnb_Data$bathrooms  
 ggplot(data.frame(x = datos), aes(x = x)) +
     geom_histogram(binwidth = 0.5, fill = "#F16E79", color = "black", 
                    ) +
  
     labs(title = "Distribución del número de baños",
          x = "Número de baños",
          y = "Frecuencia") 
```

Observamos una clara predominancia de propiedades con un solo baño, siendo también un tanto notables las propiedades con 1.5 y 2 baños. Hay casas con hasta 8 baños, pero es mísera la cantidad de propiedades que se venden con 4 o más de estos. También es sorprendente observar que, por pocas que sean, se oferten casas con 0 baños.

RESUMEN NUMÉRICO DEL NÚMERO DE BAÑOS

También vamos a realizar el resumen numérico que nos ayude a comprender mejor el gráfico.

```{r}
Airbnb_Data |> select(bathrooms) |> descr() |> kable(digits = 2)
```

Podemos observar que se usan decimales para hablar del número de baños, esto se debe a que para poder considerar un baño completo, este tiene que tener un lavabo, un inodoro, una ducha o bañera y un mueble de almacenamiento. El gáfico nos premite ver que la mayoría de ofertas solo tiene un baño, el mínimo de baños es 0 y el máximo son 8, y la media de baños que se ofertan son 1.25 baños.

#### Estudio de la variable bedrooms

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_bedrooms <- length(unique(Airbnb_Data$bedrooms))
cat("El número de respuestas obtenido es: ", num_respuestas_bedrooms)
```

Vamos a realizar un estudio para ver las casas que se ofertan según el número de habitaciones.

TABLA DE FRECUENCIAS

Estudiamos las frecuencias relativas y absolutas.

```{r}
tabla_frecuencias_bedrooms <- Airbnb_Data |> count(bedrooms) |> mutate(f = n / nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f)) 
tabla_frecuencias_ordenada5 <- tabla_frecuencias_bedrooms |>
    arrange(desc(n))
 tabla_frecuencias_ordenada5$F <- cumsum(tabla_frecuencias_ordenada5$f)
 tabla_frecuencias_ordenada5$N <- cumsum(tabla_frecuencias_ordenada5$n)
 print(tabla_frecuencias_ordenada5)
```

HISTOGRAMA DEL NÚMERO DE HABITACIONES

```{r}
datos <- Airbnb_Data$bedrooms  
 ggplot(data.frame(x = datos), aes(x = x)) +
     geom_histogram(binwidth = 1, fill = "#F16E79", color = "black", 
                    ) +
  
     labs(title = "Distribución del Número de Habitaciones",
          x = "Número de Habitaciones",
          y = "Frecuencia") 
```

Observamos una destacable mayoría en la oferta de propiedades con una sola habitación. Muy por detrás se encuentran las propiedades con 2 habitaciones, seguidas de casas con 0 habitaciones, cosa que puede llegar a sorprender, sin embargo, ahora analizaremos el número de camas para ver si aunque haya varias propiedades sin habitaciones, no significa que no tengan cama.

RESUMEN NUMÉRICO DEL NÚMERO DE HABITACIONES

```{r}
Airbnb_Data |> select(bedrooms) |> descr() |> kable(digits = 2) 
```

#### Estudio de la variable beds

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_BEDS <- length(unique(Airbnb_Data$beds))     
cat("La cantidad de respuestas obtenidas es:", num_respuestas_BEDS)
```

TABLA DE FRECUENCIAS

Estudiamos las frecuencias relativas y absolutas.

```{r}
tabla_frecuencias_beds <- Airbnb_Data |> count(beds) |> mutate(f = n / nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f)) 
tabla_frecuencias_ordenada6 <- tabla_frecuencias_beds |>
    arrange(desc(n))
 tabla_frecuencias_ordenada6$F <- cumsum(tabla_frecuencias_ordenada6$f)
 tabla_frecuencias_ordenada6$N <- cumsum(tabla_frecuencias_ordenada6$n)
 print(tabla_frecuencias_ordenada6)
```

HISTOGRAMA DEL NÚMERO DE CAMAS

```{r}
datos <- Airbnb_Data$beds  
 ggplot(data.frame(x = datos), aes(x = x)) +
     geom_histogram(binwidth = 1, fill = "#F16E79", color = "black", 
                    ) +
  
     labs(title = "Distribución del Número de Camas",
          x = "Número de camas",
          y = "Frecuencia") 
```

ANÁLISIS NUMÉRICO

```{r}
Airbnb_Data |> select(beds) |> descr() |> kable(digits = 2)
```

Se puede ver como la mayoria de ofertas ofrecen 1 o 2 camas, mientras que ya es infrecuente que haya de 5 para arriba, si no es que 0.

#### Estudio de la variable bed_type

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_bed_type <- length(unique(Airbnb_Data$bed_type))
cat("El número de respuestas obtenido es: ", num_respuestas_bed_type)
```

Aquí estudiaremos cuales son los tipos de camas que más se ofertan.

FRECUENCIAS RELATIVAS Y ABSOLUTAS

Primero estudiaremos las frecuencias relativas y absolutas.

```{r}
tabla_frec_bed_type <- Airbnb_Data |> count(bed_type) |> mutate (f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_5 <- tabla_frec_bed_type |> arrange(desc(n)) 
tabla_frec_ord_5$N <- cumsum(tabla_frec_ord_5$n)
tabla_frec_ord_5$F <- cumsum(tabla_frec_ord_5$f) 
print(tabla_frec_ord_5)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

Para poder observar los datos en función de frecuencia relativa con mayor claridad realizaremos una gráfica.

```{r}
Airbnb_Data  |> group_by(bed_type) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), bed_type = reorder(bed_type, -Frequency)) |> ggplot(aes(x = bed_type, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de bed_type", x = "Tipo de cama", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

De la misma forma realizaremos un gráfico con las frecuencias absolutas.

```{r}
Airbnb_Data  |> group_by(bed_type) |>  summarise(Frequency = n()) |> mutate(bed_type = reorder(bed_type, -Frequency)) |> ggplot(aes(x = bed_type, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de bed_type", x = "Tipo de cama", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Como podemos observar en los gráficos casi el 100% de las camas son camas normales, y muy pocas son las ofertas que tiene algún otro tipo de cama.

#### Estudio de la variable cancellation_policy

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_cancellation_policy <- length(unique(Airbnb_Data$cancellation_policy)) 
cat("El número de respuestas es: ", num_respuestas_cancellation_policy)
```

Aquí vamos a estudiar cuales son las políticas de cancelación más presentes en la plataforma.

FRECUENCIAS RELATIVAS Y ABSOLUTAS

Primero estudiaremos las frecuencias relativas y absolutas.

```{r}
tabla_frec_cancellation_policy <- Airbnb_Data |> count(cancellation_policy) |> mutate(f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_6 <- tabla_frec_bed_type |> arrange(desc(n)) 
tabla_frec_ord_6$N <- cumsum(tabla_frec_ord_6$n)
tabla_frec_ord_6$F <- cumsum(tabla_frec_ord_6$f) 
print(tabla_frec_cancellation_policy)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

Para ello vamos a realizar un gráfico para poder entender mejor los datos en función de frecuencia relativa.

```{r}
Airbnb_Data  |> group_by(cancellation_policy) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), cancellation_policy = reorder(cancellation_policy, -Frequency)) |> ggplot(aes(x = cancellation_policy, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de cancellation_policy", x = "Política de cancelación", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

De la misma forma vamos a realizar un gráfico con las frecuencias absolutas de las políticas de cancelación.

```{r}
Airbnb_Data  |> group_by(cancellation_policy) |>  summarise(Frequency = n()) |> mutate(cancellation_policy = reorder(cancellation_policy, -Frequency)) |> ggplot(aes(x = cancellation_policy, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de cancellation_policy", x = "Política de cancelación", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Estos gráficos nos muestran que la mayoría de los ofertantes son estrictos en cuanto a su política de cancelación, con alrededor del 44% del total de datos, de cerca les siguen los ofertantes con una política flexible y moderada con un 30% y 26% respectivamente, y con mucha diferencia se encuentran el resto de políticas.

#### Estudio de la variable cleaning_fee

Vamos a estudiar la variable cleaning_fee.

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_cleaning_fee <- length(unique(Airbnb_Data$cleaning_fee))
cat("El número de respuestas obtenido es: ", num_respuestas_cleaning_fee)
```

FRECUENCIAS RELATIVAS Y ABSOLUTAS

Para ello estudiamos las frecuencias relativas y absolutas.

```{r}
tabla_frec_cleaning_fee <- Airbnb_Data |> count(cleaning_fee) |> mutate(f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_7 <- tabla_frec_cleaning_fee |> arrange(desc(n)) 
tabla_frec_ord_7$N <- cumsum(tabla_frec_ord_7$n)
tabla_frec_ord_7$F <- cumsum(tabla_frec_ord_7$f) 
print(tabla_frec_cleaning_fee)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

Para entender mejor los datos vamos a realizar un gráfico de barras con frecuencia relativa de esta variable.

```{r}
Airbnb_Data  |> group_by(cleaning_fee) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), cleaning_fee = reorder(cleaning_fee, -Frequency)) |> ggplot(aes(x = cleaning_fee, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de cleaning_fee", x = "Impuesto de Limpieza", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

Del mismo modo vamos a realizar otro gráfico de barras pero esta vez de frecuencia absoluta.

```{r}
Airbnb_Data  |> group_by(cleaning_fee) |>  summarise(Frequency = n()) |> mutate(cleaning_fee = reorder(cleaning_fee, -Frequency)) |> ggplot(aes(x = cleaning_fee, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de cleaning_fee", x = "Impuesto de Limpieza", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Al ser una variable categórica dicotómica solo pueden aparecer dos resultados, verdadero o falso. Por tanto las gráficas tampoco nos dicen mucho, pero podemos ver que la mayoría de ofertas cuentan con un impuesto de limpieza.

#### Estudio de la variable city

Ahora vamos a analizar la variable city.  

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_city <- length(unique(Airbnb_Data$city))
cat("El número de respuestas obtenido es: ", num_respuestas_city)
```

FRECUENCIAS RELATIVAS Y ABSOLUTAS

Analizaremos las frecuencias relativas y absolutas.

```{r}
tabla_frec_city <- Airbnb_Data |> count(city) |> mutate(f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_8 <- tabla_frec_city |> arrange(desc(n)) 
tabla_frec_ord_8$N <- cumsum(tabla_frec_ord_8$n)
tabla_frec_ord_8$F <- cumsum(tabla_frec_ord_8$f) 
print(tabla_frec_city)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

Para entender mejor los datos vamos a realizar un gráfico de barras con frecuencia relativa.
 

```{r}
Airbnb_Data  |> group_by(city) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), city = reorder(city, -Frequency)) |> ggplot(aes(x = city, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de city", x = "Ciudades", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

Ahora realizaremos un gráfico de barras con frecuencia absoluta.

```{r}
Airbnb_Data  |> group_by(city) |>  summarise(Frequency = n()) |> mutate(city = reorder(city, -Frequency)) |> ggplot(aes(x = city, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de city", x = "Ciudades", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Podemos ver que la mayor cantidad de ofertas se encuentran en Nueva York y en Los Ángeles. La menor cantidad se encuentra en Boston.

#### Estudio de la variable host_identity_verified

Ahora analizaremos la variable host_identity_verified.

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_host_identity_verified <- length(unique(Airbnb_Data$host_identity_verified))
cat("El número de respuestas obtenido es: ", num_respuestas_host_identity_verified)
```

FRECUENCIAS RELATIVAS Y ABSOLUTAS



```{r}
tabla_frec_host_identity_verified <- Airbnb_Data |> count(Airbnb_Data$host_identity_verified) |> mutate(f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_8 <- tabla_frec_host_identity_verified |> arrange(desc(n)) 
tabla_frec_ord_8$N <- cumsum(tabla_frec_ord_8$n)
tabla_frec_ord_8$F <- cumsum(tabla_frec_ord_8$f) 
print(tabla_frec_host_identity_verified)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

```{r}
Airbnb_Data  |> group_by(host_identity_verified) |>  summarise(Frequency = n()) |> drop_na() |> mutate(Frequency = Frequency/sum(Frequency), host_identity_verified = reorder(host_identity_verified, -Frequency)) |> ggplot(aes(x = host_identity_verified, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de host_identity_verified", x = "¿Está verificado?", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

```{r}
Airbnb_Data  |> group_by(host_identity_verified) |>  summarise(Frequency = n()) |> drop_na() |> mutate(host_identity_verified = reorder(host_identity_verified, -Frequency)) |> ggplot(aes(x = host_identity_verified, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de host_identity_verified", x = "Identidad verfificada", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Vemos que aproximadamente el 66% de los anfitriones si tienen su identidad verificada

#### Estudio de la variable instant_bookable

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_instant_bookable <- length(unique(Airbnb_Data$instant_bookable))
cat("El número de respuestas obtenido es: ", num_respuestas_instant_bookable)
```

FRECUENCIAS RELATIVAS Y ABSOLUTAS

```{r}
tabla_frec_instant_bookable <- Airbnb_Data |> count(Airbnb_Data$instant_bookable) |> mutate(f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_8 <- tabla_frec_instant_bookable |> arrange(desc(n)) 
tabla_frec_ord_8$N <- cumsum(tabla_frec_ord_8$n)
tabla_frec_ord_8$F <- cumsum(tabla_frec_ord_8$f) 
print(tabla_frec_instant_bookable)
```

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

```{r}
Airbnb_Data  |> group_by(instant_bookable) |>  summarise(Frequency = n()) |> mutate(Frequency = Frequency/sum(Frequency), instant_bookable = reorder(instant_bookable, -Frequency)) |> ggplot(aes(x = instant_bookable, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de instant_bookable", x = "¿Se puede reservar al instante?", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

```{r}
Airbnb_Data  |> group_by(instant_bookable) |>  summarise(Frequency = n()) |> mutate(instant_bookable = reorder(instant_bookable, -Frequency)) |> ggplot(aes(x = instant_bookable, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de instant_bookable", x = "Reserva instantánea", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

De igual manera vemos como solo cerca de un 25% de las ofertas se pueden reservar al instante

#### Estudio de la variable neighbourhood

A continuación vamos a estudiar la variable neighbourhood. 
CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_neighbourhood <- length(unique(Airbnb_Data$neighbourhood))
cat("El número de respuestas obtenido es: ", num_respuestas_neighbourhood)
```

Al ver que el número de respuestas es muy elevado, el análisis no nos va a resultar muy útil. 

FRECUENCIAS RELATIVAS Y ABSOLUTAS

```{r}
tabla_frec_neighbourhood <- Airbnb_Data |> count(Airbnb_Data$neighbourhood) |> mutate(f = n/nrow(Airbnb_Data), N = cumsum(n), F = cumsum(f))
tabla_frec_ord_1 <- tabla_frec_neighbourhood |> arrange(desc(n)) 

print(tabla_frec_neighbourhood)
```

Vamos a realizar un gráfico de barras con frecuencia relativa.

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA

```{r}
Airbnb_Data  |> group_by(neighbourhood) |>  summarise(Frequency = n())  |>  mutate(Frequency = Frequency/sum(Frequency), neighbourhood = reorder(neighbourhood, -Frequency)) |> ggplot(aes(x = neighbourhood, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de neighbourhood", x = "Barrio", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Del mismo modo hacemos otro gráfico de barras con la frecuencia absouluta.

GRÁFICO DE BARRAS CON FRECUENCIA ABSOLUTA

```{r}
Airbnb_Data  |> group_by(neighbourhood) |>  summarise(Frequency = n()) |>  mutate(neighbourhood = reorder(neighbourhood, -Frequency)) |> ggplot(aes(x = neighbourhood, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de neighbourhood", x = "Barrios", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Como podemos observar hay tantos datos que el análisis es ilegible, por lo que hemos decidido hacer otras dos gráficas con solo los barrios que cuentan con más de 300 ofertas en la plataforma.

GRÁFICO DE BARRAS CON FRECUENCIA RELATIVA DE LOS BARRIOS CON MÁS DE 300 OFERTAS

```{r}
Airbnb_Data  |> group_by(neighbourhood) |>  summarise(Frequency = n())  |>  drop_na() |> filter(Frequency > 300)|>mutate(Frequency = Frequency/sum(Frequency), neighbourhood = reorder(neighbourhood, -Frequency)) |> ggplot(aes(x = neighbourhood, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + scale_y_continuous(labels = scales::percent) + theme_bw() + labs(title = "Gráfico de barras con frecuencia relativa de barrios con más de 300 ofertas ", x = "Barrio", y = "Frecuencia relativa") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 60, hjust = 1)) 
```

GRÁFICO DE BARRAS CON FRECUENCIA absoluta DE LOS BARRIOS CON MÁS DE 300 OFERTAS

```{r}
Airbnb_Data  |> group_by(neighbourhood) |>  summarise(Frequency = n()) |> drop_na() |> filter(Frequency > 300)|> mutate(neighbourhood = reorder(neighbourhood, -Frequency)) |> ggplot(aes(x = neighbourhood, y = Frequency)) + geom_bar(stat = "identity", aes(fill = Frequency)) + theme_bw() + labs(title = "Gráfico de barras con frecuencia absoluta de barrios con más de 3000 ofertas", x = "Barrios", y = "Frecuencia absoluta") + scale_fill_gradient("Frecuencia", low = "#F16E79", high = "#CB0019") + theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

Después de analizar solo los barrios con más de 300 ofertas, vemos que la mayor parte de ofertas se encuentran en Williamsburg (Nueva York) con un 3.9 % del total con casi 3000 ofertas. 

#### Estudio de la variable number_of_reviews

CONTAR EL NÚMERO DE RESPUESTAS

```{r NumRespuestasnumber_of_reviews, echo=TRUE}
num_respuestas_number_of_reviews <- length(unique(Airbnb_Data$number_of_reviews))
cat("La cantidad de respuestas obtenidas es:", num_respuestas_number_of_reviews)
```

HISTOGRAMA DE NÚMERO DE REVIEWS

```{r}
datos <- Airbnb_Data$number_of_reviews  
 ggplot(data.frame(x = datos), aes(x = x)) +
     geom_histogram(binwidth = 20, fill = "#F16E79", color = "black", 
                    ) +
  
     labs(title = "Distribución del número de reseñas",
          x = "Número de reseñas",
          y = "Frecuencia") 
```

RESUMEN NUMÉRICO DEL NÚMERO DE REVIEWS

```{r Resumennumber_of_reviews}
Airbnb_Data |> select(number_of_reviews) |> descr() |> kable(digits = 2)

```

El primer cuarto de las ofertas totales oscila entre las 0 y 1 reseñas, mientras que la mitad apenas llega a las 6. Fuera de ahí, resultan más bien pocos los casos que muestren más de 100 reseñas

#### Estudio de la variable review_scores_rating

CONTAR EL NÚMERO DE RESPUESTAS

```{r}
num_respuestas_review_scores_rating <- length(unique (Airbnb_Data$review_scores_rating))
cat("La cantidad de respuestas obtenidas es:", num_respuestas_review_scores_rating)
```

HISTOGRAMA DE LA PUNTUACIÓN DE REVIEWS

```{r}
datos <- Airbnb_Data$review_scores_rating  
 ggplot(data.frame(x = datos), aes(x = x)) +
     geom_histogram(binwidth = 2, fill = "#F16E79", color = "black", 
                    ) +
  
     labs(title = "Distribución de la Puntuación de reviews",
          x = "Puntuación de reviews",
          y = "Frecuencia") 
```

RESUMEN NUMÉRICO DE LA PUNTUACIÓN DE REVIEWS

```{r}
Airbnb_Data |> select(review_scores_rating) |> descr() |> kable(digits = 2)
```

Se puede ver como la mayoria de puntuaciones se acumulan por encima de 80, mientras que las puntuaciones de 100 ocupan más de un cuarto del total

### Análisis bivariante:

#### Estudio de las variables bedrooms y price

GRÁFICO DE DISPERSIÓN CON AJUSTE DE REGRESIÓN LINEAL

```{r}
Airbnb_Data |> 
    ggplot(aes(x = bedrooms, y = log_price)) +
    geom_point() +
    geom_smooth(method = lm) +
    labs(title = "Gráfico de dispersión con ajuste de regresión lineal")
```

GRÁFICO DE DISPERSIÓN IDENTIFICANDO POR LOCALIDAD

Aquí añadimos la variable city:

```{r}
Airbnb_Data |> 
    ggplot(aes(x = bedrooms, y = log_price, col = city)) +
    geom_point() +
    labs(title = "Gráfico de dispersión identificando por localidad ")

```

#### Estudio de las variables bedrooms, bathrooms, price y beds

MATRIZ DE CORRELACIÓN

```{r}
Airbnb_Data |> select(bedrooms, bathrooms, log_price, beds) |> 
    drop_na() |>  
    cor() |> 
    round(2)
```

MATRIZ DE COVARIANZA

```{r}
Airbnb_Data |> select(bedrooms, bathrooms, log_price, beds) |> 
    drop_na() |>  
    cov() |> 
    round(2)
```

GRÁFICO DE CORRELACIÓN NUMÉRICA

```{r}
Airbnb_Data |> 
    select(bedrooms, bathrooms, log_price, beds) |>
    drop_na() |> 
    cor() |> 
    round(2) |>
    corrplot(method = "ellipse",  type = "lower",      addCoef.col = "white", diag = FALSE)
```

#### Estudio de las variables bedrooms y bathrooms

```{r}
Airbnb_Data |> 
    ggplot(aes(x = bedrooms, y = bathrooms)) +
    geom_point() +
    geom_smooth(method = lm) +
    labs(title = "Gráfico de dispersión con ajuste de regresión lineal")
```

#### Estudio de las variables price y Ciudad

HISTOGRAMA DE PRECIO POR CIUDAD

```{r}
Airbnb_Data |> 
  ggplot(aes(x = city, y = log_price)) +  
  geom_boxplot() +  
  theme_bw() +  
  labs(title = "Precio por Ciudad")  
```

Gracias a este gráfico vemos que todas las ciudades presentan muchos valores atípicos, lleganto hasta los 2000\$ , salvo Boston y Chicago que tiene menos que el resto, llegando a los 1500\$, por lo tanto para poder estudiar mejor estas varibles vamos a realizar otro box-plot centrandonos en los precios de menos de 500\$.

```{r}
Airbnb_Data |> filter(log_price < 500) |> 
  ggplot(aes(x = city, y = log_price)) +  
  geom_boxplot() +  
  theme_bw() +  
  labs(title = "Precio por Ciudad")  
```

Podemos ver con más claridad como los precios más caros nos los encontramos en San Francisco y los más baratos en Los Ángeles y Chicago.

#### Estudio de las variables reseñas y precio

```{r}
Airbnb_Data |>
    ggplot(aes(x = review_scores_rating, y = log_price)) +
    geom_point() + 
    geom_smooth(method = lm) +
    labs(title = "Gráfico de dispersión con ajuste de regresión")
```

De manera general, se puede observar que las reseñas con mejor puntaje tienden a acumularse en las opciones más económicas. Este cumulo se percibe mejor como el area bajo la curva que forman los puntos

## Conclusión

Tras este análisis de los datos propuestos, podemos llegar a estas conclusiones:

